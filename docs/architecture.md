# 系统架构文档（Architecture Documentation）

本项目为 **匿名用户精准广告投放生态系统**，由五个核心子系统组成：

- 广告管理平台（系统核心）
- 购物网站（Shop Site）
- 视频网站（Video Site）
- 新闻网站（News Site）
- 公共跨站 UID 模块（common/uid.js）

系统通过统一 UID、行为日志、兴趣画像、广告分类，实现“跨网站的匿名用户精准广告投放”。

---

# 1. 总体架构图（逻辑结构）

┌──────────────────────────────────────────────┐
│                   用户浏览器                │
│   （匿名用户，持有统一 UID 的 LocalStorage）│
└─────────────────┬───────────────┬───────────┘
                  │               │
          ┌───────▼───────┐ ┌─────▼─────────┐ ┌────────▼───────────┐
          │ 购物网站前端   │ │ 视频网站前端   │ │ 新闻网站前端        │
          └───────┬───────┘ └─────┬─────────┘ └────────┬───────────┘
                  │                 │                     │
            （调用广告 API + 浏览行为上报 API）          │
                  └─────────────────┬─────────────────────┘
                                    ▼
                    ┌─────────────────────────────────┐
                    │         广告管理平台后端         │
                    │----------------------------------│
                    │ 1) 广告获取服务 /api/ads         │
                    │ 2) 日志系统 /api/log/*           │
                    │ 3) UID 管理服务                  │
                    │ 4) 用户兴趣画像服务              │
                    │ 5) 广告后台管理界面              │
                    └─────────────────┬────────────────┘
                                      │
                   ┌──────────────────┴────────────────────┐
                   ▼                                       ▼
     ┌────────────────────────┐             ┌────────────────────────────┐
     │     广告系统数据库      │             │      内容站点数据库         │
     │--------------------------│            │-----------------------------│
     │ - 广告表（Ad）           │            │ - 商品表（购物）            │
     │ - 分类表（Category）     │            │ - 视频表（视频）            │
     │ - 画像表（UserProfile）  │            │ - 新闻表（新闻）            │
     │ - 曝光/点击日志表        │            │ - 行为日志（可选）          │
     └────────────────────────┘             └────────────────────────────┘

---

# 2. 系统核心模块说明

## 2.1 广告管理平台（广告投放核心）
负责：

- 广告后台 CRUD（图片/视频/文本）
- 广告投放 API（按 UID & 类别返回广告）
- 动态兴趣画像（个性化投放）
- 曝光与点击日志系统
- UID 跨站管理

## 2.2 购物网站
- 商品分类页面
- 商品详情页
- 页面广告位
- 浏览行为上报（商品类别 → 画像）

## 2.3 视频网站
- 视频上传 / 播放
- 视频分类系统
- 视频广告插播（关键特色功能）
- 视频观看行为上报

## 2.4 新闻网站
- 新闻文章发布
- 新闻分类浏览
- 文章内广告位
- 新闻阅读行为上报

## 2.5 UID 公共模块（common/uid.js）
- 每个站点共享同一 UID
- 保存在浏览器 LocalStorage
- 所有请求必须携带 UID

---

# 3. 核心数据流与业务逻辑

## 3.1 广告请求流程
1. 用户访问某站点  
2. 加载 `/common/uid.js` 获取 UID  
3. 页面广告位请求：  
   ```
   GET /api/ads?uid=xxx&category=xxx&site=shop
   ```
4. 广告平台根据  
   - 用户画像  
   - 页面分类  
   - 广告权重  
   返回广告列表  
5. 前端渲染广告  
6. 曝光自动上报 `/api/log/exposure`  
7. 用户点击广告 `/api/log/click`

---

## 3.2 浏览行为上报流程
用于构建兴趣画像。

流程如下：

1. 用户浏览商品/视频/新闻  
2. 前端上报  
   ```
   POST /api/log/view
   ```
3. 广告平台更新该 UID 的画像  
4. 未来广告投放更精准

---

## 3.3 兴趣画像更新算法（示例）
- 每次浏览某个分类，将该分类权重 +1  
- 按时间衰减旧兴趣  
- 归一化到 0~1 区间

示例：

```
tech: 0.9
sport: 0.2
fashion: 0.1
```

---

# 4. 技术架构

| 层级 | 使用技术 |
|------|-----------|
| 前端 | HTML / JavaScript / JSP |
| 后端 | Java Servlet 或 Spring Boot |
| 数据库 | MySQL |
| 通信 | RESTful JSON API |
| 部署 | 校园网服务器（Tomcat 或独立 Spring Boot） |

---

# 5. 中期答辩演示流程建议

要点是展示“跨站精准广告投放效果”：

1. 用户打开科技新闻  
2. 系统增加用户 tech 兴趣权重  
3. 切换到购物站点 → 自动显示科技类广告  
4. 切换到视频站点 → 插播科技广告  
5. 展示后台画像变化与日志记录  

---

（完）
