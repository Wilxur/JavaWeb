# 系统架构文档（Architecture Documentation）

本项目为 **匿名用户精准广告投放生态系统**，由以下五个核心子系统组成：

- **广告管理平台（Ad Platform）**
- **购物网站（Shop Site）**
- **视频网站（Video Site）**
- **新闻网站（News Site）**
- **跨站 UID 模块（common/uid.js）**

系统通过统一 UID、行为日志、兴趣画像、广告分类，实现跨站点匿名用户的精准广告投放。

---

# 1. 总体架构图（GitHub 兼容 ASCII 版本）

```
+------------------------------------------------------------+
|                        用户浏览器                          |
|          （匿名用户，持有统一 UID 的 LocalStorage）       |
+-----------------------+--------------+----------------------+
                        |              |
         +--------------+-----+   +----+----------------+   +------------------------+
         | 购物网站前端       |   | 视频网站前端        |   | 新闻网站前端            |
         +--------------+-----+   +----+----------------+   +------------------------+
                        |              |                        |
                        |   (调用广告 API + 行为上报 API)      |
                        +--------------+------------------------+
                                       |
                                       v
                       +--------------------------------------+
                       |          广告管理平台后端            |
                       |--------------------------------------|
                       | 1) /api/ads       (广告获取)         |
                       | 2) /api/log/*     (曝光/点击/浏览)   |
                       | 3) UID 管理服务                       |
                       | 4) 用户兴趣画像服务                  |
                       | 5) 广告后台管理界面                  |
                       +-------------------+------------------+
                                           |
                +--------------------------+--------------------------+
                |                                                         |
                v                                                         v
     +-----------------------------+                     +------------------------------+
     |      广告系统数据库         |                     |      内容站点数据库          |
     |-----------------------------|                     |------------------------------|
     | - 广告表（Ad）              |                     | - 商品表（Product）          |
     | - 分类表（Category）        |                     | - 视频表（Video）            |
     | - 画像表（UserProfile）     |                     | - 新闻表（News）             |
     | - 曝光/点击日志（Log）      |                     | - 行为日志（可选）           |
     +-----------------------------+                     +------------------------------+
```

---

# 2. 系统核心模块说明

## 2.1 广告管理平台（核心）
广告平台负责：
- 广告上传、编辑、删除
- 广告分类管理
- 广告投放 API（根据 UID + 分类推荐广告）
- 曝光、点击、浏览日志记录
- 用户兴趣画像更新与管理
- UID 发行与校验

---

## 2.2 购物网站（Shop Site）
- 商品分类浏览
- 商品详情展示
- 页面广告位调用 `/api/ads`
- 浏览行为上报 `/api/log/view`

---

## 2.3 视频网站（Video Site）
- 视频上传 / 播放
- 视频分类
- 视频广告插入（贴片、暂停页广告）
- 观看行为上报

---

## 2.4 新闻网站（News Site）
- 新闻发布、浏览、分类展示
- 文章内容广告加载
- 浏览行为上报

---

## 2.5 跨站 UID 模块（common/uid.js）
- 生成统一 UID（LocalStorage）
- 三个站点共用同一个 UID
- 用于所有 API 请求身份识别

---

# 3. 系统数据流说明

## 3.1 用户访问页面
1. 加载 UID 模块 → 获取 UID  
2. 加载广告位  
3. 调用广告获取接口 `/api/ads`  
4. 返回广告并展示  
5. 曝光自动记录  
6. 用户点击 → 点击日志记录  

---

## 3.2 用户浏览行为上报
- 浏览商品 → 上报 `category=digital`
- 浏览视频 → 上报 `category=game`
- 浏览文章 → 上报 `category=tech`

广告系统根据用户的多站点浏览行为自动更新画像。

---

## 3.3 兴趣画像逻辑

示例画像 JSON：

```json
{
  "tech": 0.8,
  "sport": 0.2,
  "fashion": 0.1
}
```

更新方式：
- 按浏览行为累计分类权重
- 按时间衰减旧行为
- 归一化输出画像分布

---

# 4. 技术架构

| 层级 | 技术 |
|------|------|
| 前端 | HTML / CSS / JavaScript / JSP |
| 后端 | Java Servlet / Spring Boot |
| API | RESTful JSON |
| 数据库存储 | MySQL |
| 部署 | 校园网服务器（Tomcat 或 SpringBoot 独立运行） |

---

# 5. 中期答辩推荐演示流程

1. 打开科技新闻页面  
2. 用户兴趣画像中的 `tech` 权重上升  
3. 切换到购物网站 → 推荐科技类广告  
4. 切换到视频网站 → 插播科技类视频广告  
5. 展示后台画像变化、日志记录数据  

---

（完）
